import{r as B,a as f,f as l,j as e,Q as P,R as T,U as E,B as x,V as I,g as A,W as v,u as C,P as S,d as j,e as U}from"./index-bbadcd21.js";import{C as y,T as L,u as b}from"./index.esm-454a3e54.js";import{G as h}from"./Grid-c02e8b16.js";import{L as D}from"./LoadingButton-06595b45.js";import"./Select-98eac33f.js";import"./index-1aacdabe.js";import"./useControlled-086bd1ce.js";import"./useFormControl-a2267305.js";import"./isMuiElement-dbbb1042.js";import"./CircularProgress-8909a85d.js";class O{static getAll(){return B.get("/avatars").then(s=>s.data.data)}}const F=r=>{const{$on:s}=A(),{user:i}=f(),[a,o]=l.useState(!1),[c,u]=l.useState([]),[d,m]=l.useState(""),g=()=>{v.update(i.id,{avatarId:d.id})},n=()=>{O.getAll().then(t=>{u(t)})},p=()=>{o(!1)},k=t=>{m(t)},w=()=>{g(),p()};return l.useEffect(()=>{n()},[]),l.useEffect(()=>{s("modal/avatar-picking/open",({defaultAvatar:t})=>{o(!0),m(t)})},[s]),e.jsxs(P,{open:a,onClose:p,children:[e.jsx(T,{children:"Change Avatar"}),e.jsx(E,{children:e.jsx(h,{container:!0,children:c&&c.map(t=>e.jsx(h,{item:!0,lg:4,md:4,sm:6,xs:12,children:e.jsx(x,{variant:d&&t.id===d.id?"outlined":"text",onClick:()=>{k(t)},children:t.isCustomAvatar?e.jsx("model-viewer",{style:{width:"100%",height:"100%"},src:t.url}):e.jsx("img",{width:512,height:512,style:{width:"100%",height:"100%"},src:t.images.preview.url,alt:""})})},t.id))})}),e.jsxs(I,{children:[e.jsx(x,{onClick:p,children:"Cancel"}),e.jsx(D,{variant:"contained",onClick:w,children:"Save"})]})]})},M=({avatar:r,handleOpenAvatarPickingModal:s})=>{const{t:i}=C();return e.jsx(S,{elevation:4,sx:{p:2,minHeight:"512px"},children:e.jsx(j,{direction:"column",alignItems:"center",sx:{height:"100%",width:"100%"},children:e.jsxs(j,{direction:"column",spacing:1,sx:{width:"100%"},children:[e.jsxs(U,{style:{width:"100%",height:512},children:[r&&e.jsx("model-viewer",{style:{display:"block",width:"100%",height:"100%"},src:r.gltfs.avatar,"camera-controls":!0})," "]}),e.jsx(x,{variant:"contained",onClick:s,sx:{alignSelf:"center"},children:i("BUTTON.change")})]})})})},G=({control:r,handleSaveUserInfo:s})=>{const{t:i}=C();return e.jsx(S,{elevation:4,sx:{p:2},children:e.jsxs(j,{direction:"column",alignItems:"center",spacing:2,sx:{width:"100%"},children:[e.jsx(y,{name:"username",control:r,render:({field:{onChange:a,value:o}})=>e.jsx(L,{fullWidth:!0,InputLabelProps:{shrink:!0},onChange:a,value:o,label:i("LABEL.username")})}),e.jsx(x,{variant:"contained",onClick:s,children:i("BUTTON.save")})]})})},K=()=>{const{control:r,reset:s,handleSubmit:i}=b(),{user:a}=f(),{$emit:o}=A(),[c,u]=l.useState(),d=()=>{a&&a.avatarId&&v.getAvatar(a.id).then(n=>{console.log({avatar:n}),u(n)})},m=()=>{o("modal/avatar-picking/open",{defaultAvatar:c})},g=i(n=>{v.update(a.id,{username:n.username})});return l.useEffect(()=>{d();let n={};a&&(n.username=a.username,s({...n}))},[a]),e.jsxs(e.Fragment,{children:[e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,lg:6,md:6,sm:12,xs:12,children:e.jsx(M,{avatar:c,handleOpenAvatarPickingModal:m})}),e.jsx(h,{item:!0,lg:6,md:6,sm:12,xs:12,children:e.jsx(G,{control:r,handleSaveUserInfo:g})})]}),e.jsx(F,{defaultAvatar:c,setAvatar:u})]})};export{K as default};
