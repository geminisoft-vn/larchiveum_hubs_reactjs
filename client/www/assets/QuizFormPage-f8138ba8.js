import{r as x,f as w,j as e,d as l,B as f,P as E,T as S,M as I,u as Q,X as P,L as T}from"./index-bbadcd21.js";import{a as C,T as g,C as q,b as k,u as A,F}from"./index.esm-454a3e54.js";import{d as V,a as z}from"./SaveRounded-50db9cad.js";import{l as D}from"./lodash-ea666404.js";import{Q as v}from"./QuizService-03521a75.js";import{G as j}from"./Grid-c02e8b16.js";import{F as L}from"./FormControlLabel-be5ae592.js";import{S as O}from"./Switch-016e96b4.js";import{S as M}from"./Select-98eac33f.js";import"./useFormControl-a2267305.js";import"./isMuiElement-dbbb1042.js";import"./createSvgIcon-3ac82221.js";import"./useControlled-086bd1ce.js";import"./SwitchBase-e025f83e.js";import"./index-1aacdabe.js";class b{static create(t){return x.post("/questions",t).then(n=>n.data.data)}static update(t,n){return x.put(`/questions/${t}`,n).then(i=>i.data.data)}static delete(t){return x.delete(`/questions/${t}`).then(n=>n.data.data)}}class y{static create(t){return x.post("/options",t).then(n=>n.data.data)}static update(t,n){return x.put(`/options/${t}`,n).then(i=>i.data.data)}static delete(t){return x.delete(`/options/${t}`).then(n=>n.data.data)}}const B=u=>{const{questionIndex:t,optionIndex:n,handleDeleteAnswer:i,handleChangeCorrectAnswer:d}=u,{register:r,control:o,watch:a,getValues:p}=C();return w.useEffect(()=>{const s=a((c,{name:h,type:m})=>{m==="change"&&h.includes("isCorrect")&&p(`questions.${t}.type`)==="single"&&d(h)});return()=>s.unsubscribe()},[a]),e.jsx(l,{sx:{px:2},children:e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,lg:8,md:8,sm:12,xs:12,children:e.jsx(g,{fullWidth:!0,placeholder:"Enter your option",...r(`questions.${t}.options.${n}.content`)})}),e.jsx(j,{item:!0,lg:4,md:4,sm:12,xs:12,children:e.jsxs(l,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{pl:2},children:[e.jsx(L,{control:e.jsx(q,{defaultValue:!1,name:`questions.${t}.options.${n}.isCorrect`,control:o,render:({field:s})=>e.jsx(O,{onChange:c=>s.onChange(c.target.checked),checked:s.value})}),label:"Correct"}),e.jsx(f,{variant:"contained",onClick:i,children:"Delete Answer"})]})})]})})},U=u=>{const{questionIndex:t}=u,{control:n,getValues:i}=C(),{fields:d,append:r,remove:o,update:a}=k({control:n,name:`questions.${t}.options`,rules:{maxLength:10}}),p=s=>{i(s)&&i(`questions.${t}.options`).forEach((h,m)=>{s!==`questions.${t}.options.${m}.isCorrect`&&a(m,{isCorrect:!1,content:i(`questions.${t}.options.${m}.content`)})})};return e.jsxs(l,{direction:"column",spacing:2,children:[e.jsx(l,{direction:"column",spacing:2,children:d.map((s,c)=>e.jsx(B,{optionIndex:c,questionIndex:t,handleDeleteAnswer:()=>o(c),handleChangeCorrectAnswer:p},s.id))}),e.jsx(f,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>r({content:""}),children:"Add Answer"})]})},_=u=>{const{handleDeleteQuestion:t,questionIndex:n}=u,{register:i,getValues:d,control:r}=C();return e.jsx(E,{elevation:4,sx:{p:2},children:e.jsxs(l,{direction:"column",spacing:2,children:[e.jsxs(l,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(S,{children:["Question #",n+1]}),e.jsx(f,{variant:"outlined",onClick:t,children:"Delete"})]}),e.jsx(l,{children:e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xl:8,lg:8,md:8,sm:12,xs:12,children:e.jsx(g,{defaultValue:"",fullWidth:!0,...i(`questions.${n}.content`),placeholder:"Enter your question"})}),e.jsx(j,{item:!0,xl:4,lg:4,md:4,sm:12,xs:12,children:e.jsx(q,{control:r,name:`questions.${n}.type`,defaultValue:d(`questions.${n}.type`)||"single",render:({field:o})=>e.jsxs(M,{fullWidth:!0,...o,MenuProps:{disableScrollLock:!0},children:[e.jsx(I,{value:"single",children:"Single"}),e.jsx(I,{value:"multiple",children:"Multiple"})]})})})]})}),e.jsx(U,{questionIndex:n})]})})},N=10,W=u=>{const{control:t}=C(),{fields:n,append:i,remove:d}=k({control:t,name:"questions",rules:{maxLength:10}});return e.jsxs(l,{direction:"column",alignItems:"center",spacing:2,children:[e.jsx(l,{direction:"column",spacing:2,sx:{width:"100%"},children:n.map((r,o)=>e.jsx(_,{questionIndex:o,question:r,handleDeleteQuestion:()=>d(o)},r.id))}),e.jsx(l,{children:n&&n.length<N&&e.jsx(f,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>i({content:""}),children:"Add Question"})})]})},ae=()=>{const{t:u}=Q(),{id:t}=P();console.log({quizId:t});const n=A({}),i=async()=>{if(t){const r=await v.getOne(t);let o={};o.title=r.title,o.desc=r.desc,o.questions=r.questions,n.reset({...o})}},d=n.handleSubmit(r=>{var o;if(t){const{dirtyFields:a}=n.formState,p={};["title","desc"].forEach(s=>{a[s]&&(p[s]=r[s])}),(a.title||a.desc)&&v.update(t,p),a.questions&&Promise.all(r.questions.map(s=>b.update(s.id,{content:s.content,type:s.type}))),(o=a.questions)!=null&&o.some(s=>s.options)&&Promise.all(r.questions.map(s=>s.options.map(c=>y.update(c.id,{content:c.content,isCorrect:c.isCorrect}))))}else v.create(D.pick(r,["title","desc"])).then(a=>{const{id:p}=a;Promise.all(r.questions.map(s=>b.create({quizId:p,content:s.content,type:s.type}))).then(s=>{const c=s.map(h=>h.id);Promise.all(c.map((h,m)=>r.questions[m].options.map($=>y.create({questionId:h,content:$.content,isCorrect:$.isCorrect}))))})})});return w.useEffect(()=>{i()},[t]),e.jsx(F,{...n,children:e.jsxs(l,{direction:"column",spacing:2,children:[e.jsxs(l,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(T,{to:"/home/content?tab=0",children:e.jsx(f,{variant:"contained",startIcon:e.jsx(V,{}),children:u("BUTTON.back")})}),e.jsxs(S,{variant:"h6",sx:{textAlign:"center"},children:[t?"Edit":"Create"," Quiz"]}),e.jsx(f,{variant:"contained",endIcon:e.jsx(z,{}),onClick:d,children:u("BUTTON.save")})]}),e.jsx(q,{name:"title",control:n.control,render:({field:r})=>e.jsx(g,{defaultValue:"",label:"Title",InputLabelProps:{shrink:!0},placeholder:"Enter quiz's title",...r})}),e.jsx(q,{name:"desc",control:n.control,render:({field:r})=>e.jsx(g,{defaultValue:"",label:"Description",InputLabelProps:{shrink:!0},placeholder:"Enter quiz's description",...r})}),e.jsx(W,{})]})})};export{ae as default};
