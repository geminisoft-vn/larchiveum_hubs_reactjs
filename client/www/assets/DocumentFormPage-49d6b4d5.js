import{r as H,p as n,f as C,u as F,X as K,j as g,d as I,L as U,B as z,T as q}from"./index-bbadcd21.js";import{u as G,C as O,T as D}from"./index.esm-454a3e54.js";import{d as $,a as J}from"./SaveRounded-50db9cad.js";import{D as _}from"./DocumentService-2606a562.js";import{L as W}from"./LoadingButton-06595b45.js";import"./Select-98eac33f.js";import"./index-1aacdabe.js";import"./useControlled-086bd1ce.js";import"./useFormControl-a2267305.js";import"./isMuiElement-dbbb1042.js";import"./createSvgIcon-3ac82221.js";import"./CircularProgress-8909a85d.js";class X{static upload(t){return H.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>i.data)}}var w=globalThis&&globalThis.__assign||function(){return w=Object.assign||function(r){for(var t,i=1,e=arguments.length;i<e;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},w.apply(this,arguments)},A={onActivate:n.func,onAddUndo:n.func,onBeforeAddUndo:n.func,onBeforeExecCommand:n.func,onBeforeGetContent:n.func,onBeforeRenderUI:n.func,onBeforeSetContent:n.func,onBeforePaste:n.func,onBlur:n.func,onChange:n.func,onClearUndos:n.func,onClick:n.func,onContextMenu:n.func,onCommentChange:n.func,onCopy:n.func,onCut:n.func,onDblclick:n.func,onDeactivate:n.func,onDirty:n.func,onDrag:n.func,onDragDrop:n.func,onDragEnd:n.func,onDragGesture:n.func,onDragOver:n.func,onDrop:n.func,onExecCommand:n.func,onFocus:n.func,onFocusIn:n.func,onFocusOut:n.func,onGetContent:n.func,onHide:n.func,onInit:n.func,onKeyDown:n.func,onKeyPress:n.func,onKeyUp:n.func,onLoadContent:n.func,onMouseDown:n.func,onMouseEnter:n.func,onMouseLeave:n.func,onMouseMove:n.func,onMouseOut:n.func,onMouseOver:n.func,onMouseUp:n.func,onNodeChange:n.func,onObjectResizeStart:n.func,onObjectResized:n.func,onObjectSelected:n.func,onPaste:n.func,onPostProcess:n.func,onPostRender:n.func,onPreProcess:n.func,onProgressState:n.func,onRedo:n.func,onRemove:n.func,onReset:n.func,onSaveContent:n.func,onSelectionChange:n.func,onSetAttrib:n.func,onSetContent:n.func,onShow:n.func,onSubmit:n.func,onUndo:n.func,onVisualAid:n.func,onSkinLoadError:n.func,onThemeLoadError:n.func,onModelLoadError:n.func,onPluginLoadError:n.func,onIconsLoadError:n.func,onLanguageLoadError:n.func,onScriptsLoad:n.func,onScriptsLoadError:n.func},Q=w({apiKey:n.string,id:n.string,inline:n.bool,init:n.object,initialValue:n.string,onEditorChange:n.func,value:n.string,tagName:n.string,cloudChannel:n.string,plugins:n.oneOfType([n.string,n.array]),toolbar:n.oneOfType([n.string,n.array]),disabled:n.bool,textareaName:n.string,tinymceScriptSrc:n.oneOfType([n.string,n.arrayOf(n.string),n.arrayOf(n.shape({src:n.string,async:n.bool,defer:n.bool}))]),rollback:n.oneOfType([n.number,n.oneOf([!1])]),scriptLoading:n.shape({async:n.bool,defer:n.bool,delay:n.number})},A),k=function(r){return typeof r=="function"},B=function(r){return r in A},x=function(r){return r.substr(2)},Y=function(r,t,i,e,o,s,u){var a=Object.keys(o).filter(B),l=Object.keys(s).filter(B),f=a.filter(function(c){return s[c]===void 0}),p=l.filter(function(c){return o[c]===void 0});f.forEach(function(c){var d=x(c),v=u[d];i(d,v),delete u[d]}),p.forEach(function(c){var d=e(r,c),v=x(c);u[v]=d,t(v,d)})},Z=function(r,t,i,e,o){return Y(o,r.on.bind(r),r.off.bind(r),function(s,u){return function(a){var l;return(l=s(u))===null||l===void 0?void 0:l(a,r)}},t,i,e)},P=0,V=function(r){var t=Date.now(),i=Math.floor(Math.random()*1e9);return P++,r+"_"+i+P+String(t)},M=function(r){return r!==null&&(r.tagName.toLowerCase()==="textarea"||r.tagName.toLowerCase()==="input")},N=function(r){return typeof r>"u"||r===""?[]:Array.isArray(r)?r:r.split(" ")},ee=function(r,t){return N(r).concat(N(t))},ne=function(){return window.InputEvent&&typeof InputEvent.prototype.getTargetRanges=="function"},te=function(r){if(!("isConnected"in Node.prototype)){for(var t=r,i=r.parentNode;i!=null;)t=i,i=t.parentNode;return t===r.ownerDocument}return r.isConnected},R=function(r,t){r!==void 0&&(r.mode!=null&&typeof r.mode=="object"&&typeof r.mode.set=="function"?r.mode.set(t):r.setMode(t))},L=globalThis&&globalThis.__assign||function(){return L=Object.assign||function(r){for(var t,i=1,e=arguments.length;i<e;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},L.apply(this,arguments)},re=function(r,t,i){var e,o,s=r.createElement("script");s.referrerPolicy="origin",s.type="application/javascript",s.id=t.id,s.src=t.src,s.async=(e=t.async)!==null&&e!==void 0?e:!1,s.defer=(o=t.defer)!==null&&o!==void 0?o:!1;var u=function(){s.removeEventListener("load",u),s.removeEventListener("error",a),i(t.src)},a=function(l){s.removeEventListener("load",u),s.removeEventListener("error",a),i(t.src,l)};s.addEventListener("load",u),s.addEventListener("error",a),r.head&&r.head.appendChild(s)},ie=function(r){var t={},i=function(u,a){var l=t[u];l.done=!0,l.error=a;for(var f=0,p=l.handlers;f<p.length;f++){var c=p[f];c(u,a)}l.handlers=[]},e=function(u,a,l){var f=function(E){return l!==void 0?l(E):console.error(E)};if(u.length===0){f(new Error("At least one script must be provided"));return}for(var p=0,c=!1,d=function(E,j){c||(j?(c=!0,f(j)):++p===u.length&&a())},v=0,h=u;v<h.length;v++){var m=h[v],y=t[m.src];if(y)y.done?d(m.src,y.error):y.handlers.push(d);else{var b=V("tiny-");t[m.src]={id:b,src:m.src,done:!1,error:null,handlers:[d]},re(r,L({id:b},m),i)}}},o=function(){for(var u,a=0,l=Object.values(t);a<l.length;a++){var f=l[a],p=r.getElementById(f.id);p!=null&&p.tagName==="SCRIPT"&&((u=p.parentNode)===null||u===void 0||u.removeChild(p))}t={}},s=function(){return r};return{loadScripts:e,deleteScripts:o,getDocument:s}},oe=function(){var r=[],t=function(o){var s=r.find(function(u){return u.getDocument()===o});return s===void 0&&(s=ie(o),r.push(s)),s},i=function(o,s,u,a,l){var f=function(){return t(o).loadScripts(s,a,l)};u>0?setTimeout(f,u):f()},e=function(){for(var o=r.pop();o!=null;o=r.pop())o.deleteScripts()};return{loadList:i,reinitialize:e}},ae=oe(),T=function(r){var t=r;return t&&t.tinymce?t.tinymce:null},se=globalThis&&globalThis.__extends||function(){var r=function(t,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])},r(t,i)};return function(t,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");r(t,i);function e(){this.constructor=t}t.prototype=i===null?Object.create(i):(e.prototype=i.prototype,new e)}}(),S=globalThis&&globalThis.__assign||function(){return S=Object.assign||function(r){for(var t,i=1,e=arguments.length;i<e;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},S.apply(this,arguments)},ue=function(r){se(t,r);function t(i){var e=this,o,s,u;return e=r.call(this,i)||this,e.rollbackTimer=void 0,e.valueCursor=void 0,e.rollbackChange=function(){var a=e.editor,l=e.props.value;a&&l&&l!==e.currentContent&&a.undoManager.ignore(function(){if(a.setContent(l),e.valueCursor&&(!e.inline||a.hasFocus()))try{a.selection.moveToBookmark(e.valueCursor)}catch{}}),e.rollbackTimer=void 0},e.handleBeforeInput=function(a){if(e.props.value!==void 0&&e.props.value===e.currentContent&&e.editor&&(!e.inline||e.editor.hasFocus()))try{e.valueCursor=e.editor.selection.getBookmark(3)}catch{}},e.handleBeforeInputSpecial=function(a){(a.key==="Enter"||a.key==="Backspace"||a.key==="Delete")&&e.handleBeforeInput(a)},e.handleEditorChange=function(a){var l=e.editor;if(l&&l.initialized){var f=l.getContent();e.props.value!==void 0&&e.props.value!==f&&e.props.rollback!==!1&&(e.rollbackTimer||(e.rollbackTimer=window.setTimeout(e.rollbackChange,typeof e.props.rollback=="number"?e.props.rollback:200))),f!==e.currentContent&&(e.currentContent=f,k(e.props.onEditorChange)&&e.props.onEditorChange(f,l))}},e.handleEditorChangeSpecial=function(a){(a.key==="Backspace"||a.key==="Delete")&&e.handleEditorChange(a)},e.initialise=function(a){var l,f,p;a===void 0&&(a=0);var c=e.elementRef.current;if(c){if(!te(c)){if(a===0)setTimeout(function(){return e.initialise(1)},1);else if(a<100)setTimeout(function(){return e.initialise(a+1)},100);else throw new Error("tinymce can only be initialised when in a document");return}var d=T(e.view);if(!d)throw new Error("tinymce should have been loaded into global scope");var v=S(S({},e.props.init),{selector:void 0,target:c,readonly:e.props.disabled,inline:e.inline,plugins:ee((l=e.props.init)===null||l===void 0?void 0:l.plugins,e.props.plugins),toolbar:(f=e.props.toolbar)!==null&&f!==void 0?f:(p=e.props.init)===null||p===void 0?void 0:p.toolbar,setup:function(h){e.editor=h,e.bindHandlers({}),e.inline&&!M(c)&&h.once("PostRender",function(m){h.setContent(e.getInitialValue(),{no_events:!0})}),e.props.init&&k(e.props.init.setup)&&e.props.init.setup(h)},init_instance_callback:function(h){var m,y,b=e.getInitialValue();e.currentContent=(m=e.currentContent)!==null&&m!==void 0?m:h.getContent(),e.currentContent!==b&&(e.currentContent=b,h.setContent(b),h.undoManager.clear(),h.undoManager.add(),h.setDirty(!1));var E=(y=e.props.disabled)!==null&&y!==void 0?y:!1;R(e.editor,E?"readonly":"design"),e.props.init&&k(e.props.init.init_instance_callback)&&e.props.init.init_instance_callback(h)}});e.inline||(c.style.visibility=""),M(c)&&(c.value=e.getInitialValue()),d.init(v)}},e.id=e.props.id||V("tiny-react"),e.elementRef=C.createRef(),e.inline=(u=(o=e.props.inline)!==null&&o!==void 0?o:(s=e.props.init)===null||s===void 0?void 0:s.inline)!==null&&u!==void 0?u:!1,e.boundHandlers={},e}return Object.defineProperty(t.prototype,"view",{get:function(){var i,e;return(e=(i=this.elementRef.current)===null||i===void 0?void 0:i.ownerDocument.defaultView)!==null&&e!==void 0?e:window},enumerable:!1,configurable:!0}),t.prototype.componentDidUpdate=function(i){var e=this,o,s;if(this.rollbackTimer&&(clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0),this.editor&&(this.bindHandlers(i),this.editor.initialized)){if(this.currentContent=(o=this.currentContent)!==null&&o!==void 0?o:this.editor.getContent(),typeof this.props.initialValue=="string"&&this.props.initialValue!==i.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),this.editor.setDirty(!1);else if(typeof this.props.value=="string"&&this.props.value!==this.currentContent){var u=this.editor;u.undoManager.transact(function(){var l;if(!e.inline||u.hasFocus())try{l=u.selection.getBookmark(3)}catch{}var f=e.valueCursor;if(u.setContent(e.props.value),!e.inline||u.hasFocus())for(var p=0,c=[l,f];p<c.length;p++){var d=c[p];if(d)try{u.selection.moveToBookmark(d),e.valueCursor=d;break}catch{}}})}if(this.props.disabled!==i.disabled){var a=(s=this.props.disabled)!==null&&s!==void 0?s:!1;R(this.editor,a?"readonly":"design")}}},t.prototype.componentDidMount=function(){var i=this,e,o,s,u,a;if(T(this.view)!==null)this.initialise();else if(Array.isArray(this.props.tinymceScriptSrc)&&this.props.tinymceScriptSrc.length===0)(o=(e=this.props).onScriptsLoadError)===null||o===void 0||o.call(e,new Error("No `tinymce` global is present but the `tinymceScriptSrc` prop was an empty array."));else if(!((s=this.elementRef.current)===null||s===void 0)&&s.ownerDocument){var l=function(){var p,c;(c=(p=i.props).onScriptsLoad)===null||c===void 0||c.call(p),i.initialise()},f=function(p){var c,d;(d=(c=i.props).onScriptsLoadError)===null||d===void 0||d.call(c,p)};ae.loadList(this.elementRef.current.ownerDocument,this.getScriptSources(),(a=(u=this.props.scriptLoading)===null||u===void 0?void 0:u.delay)!==null&&a!==void 0?a:0,l,f)}},t.prototype.componentWillUnmount=function(){var i=this,e=this.editor;e&&(e.off(this.changeEvents(),this.handleEditorChange),e.off(this.beforeInputEvent(),this.handleBeforeInput),e.off("keypress",this.handleEditorChangeSpecial),e.off("keydown",this.handleBeforeInputSpecial),e.off("NewBlock",this.handleEditorChange),Object.keys(this.boundHandlers).forEach(function(o){e.off(o,i.boundHandlers[o])}),this.boundHandlers={},e.remove(),this.editor=void 0)},t.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},t.prototype.changeEvents=function(){var i,e,o,s=(o=(e=(i=T(this.view))===null||i===void 0?void 0:i.Env)===null||e===void 0?void 0:e.browser)===null||o===void 0?void 0:o.isIE();return s?"change keyup compositionend setcontent CommentChange":"change input compositionend setcontent CommentChange"},t.prototype.beforeInputEvent=function(){return ne()?"beforeinput SelectionChange":"SelectionChange"},t.prototype.renderInline=function(){var i=this.props.tagName,e=i===void 0?"div":i;return C.createElement(e,{ref:this.elementRef,id:this.id})},t.prototype.renderIframe=function(){return C.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id})},t.prototype.getScriptSources=function(){var i,e,o=(i=this.props.scriptLoading)===null||i===void 0?void 0:i.async,s=(e=this.props.scriptLoading)===null||e===void 0?void 0:e.defer;if(this.props.tinymceScriptSrc!==void 0)return typeof this.props.tinymceScriptSrc=="string"?[{src:this.props.tinymceScriptSrc,async:o,defer:s}]:this.props.tinymceScriptSrc.map(function(f){return typeof f=="string"?{src:f,async:o,defer:s}:f});var u=this.props.cloudChannel,a=this.props.apiKey?this.props.apiKey:"no-api-key",l="https://cdn.tiny.cloud/1/".concat(a,"/tinymce/").concat(u,"/tinymce.min.js");return[{src:l,async:o,defer:s}]},t.prototype.getInitialValue=function(){return typeof this.props.initialValue=="string"?this.props.initialValue:typeof this.props.value=="string"?this.props.value:""},t.prototype.bindHandlers=function(i){var e=this;if(this.editor!==void 0){Z(this.editor,i,this.props,this.boundHandlers,function(a){return e.props[a]});var o=function(a){return a.onEditorChange!==void 0||a.value!==void 0},s=o(i),u=o(this.props);!s&&u?(this.editor.on(this.changeEvents(),this.handleEditorChange),this.editor.on(this.beforeInputEvent(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):s&&!u&&(this.editor.off(this.changeEvents(),this.handleEditorChange),this.editor.off(this.beforeInputEvent(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}},t.propTypes=Q,t.defaultProps={cloudChannel:"6"},t}(C.Component);const Ee=()=>{const{t:r}=F(),{id:t}=K(),{control:i,reset:e,handleSubmit:o,formState:{isSubmitting:s}}=G(),u=async()=>{if(t){const c=await _.getOne(t);let d={};d.title=c.title,d.desc=c.desc,e({...d}),l(c.content)}},[a,l]=C.useState(""),f=(c,d,v)=>{const h=document.createElement("input");h.setAttribute("type","file"),v.filetype==="image"&&h.setAttribute("accept","image/*"),v.filetype==="media"&&h.setAttribute("accept","video/*,audio/*"),h.addEventListener("change",m=>{const{files:y}=m.target;y&&X.upload({files:y[0]}).then(b=>{c("https://api.larchiveum.link"+b[0].url,{title:b[0].name})})}),h.click()},p=o(c=>{const d={title:c.title,desc:c.desc,content:a};t?_.update(t,d):_.create(d)});return C.useEffect(()=>{u()},[t]),g.jsxs(I,{direction:"column",spacing:2,children:[g.jsxs(I,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[g.jsx(U,{to:"/home/content?tab=1",children:g.jsx(z,{variant:"contained",startIcon:g.jsx($,{}),children:r("BUTTON.back")})}),g.jsxs(q,{variant:"h6",sx:{textAlign:"center"},children:[t?"Edit":"Create"," Document"]}),g.jsx(W,{loading:s,endIcon:g.jsx(J,{}),variant:"contained",onClick:p,children:r("BUTTON.save")})]}),g.jsx(O,{name:"title",control:i,render:({field:c})=>g.jsx(D,{InputLabelProps:{shrink:!0},label:"Title",...c})}),g.jsx(O,{name:"desc",control:i,render:({field:c})=>g.jsx(D,{label:"Description",InputLabelProps:{shrink:!0},...c})}),g.jsx(ue,{apiKey:"n4peat6u9i8lam0qbxvn226a6ntjpnyd8udunftjeid9kofe",value:a,onEditorChange:c=>{l(c)},init:{forced_root_block:"",min_height:512,width:"100%",menubar:!0,file_picker_callback:f,image_title:!0,automatic_uploads:!0,file_picker_types:"image",plugins:["advlist","autolink","lists","link","image","media","charmap","preview","anchor","searchreplace","visualblocks","fullscreen","insertdatetime","table","help","wordcount","autoresize"],toolbar:"undo redo | casechange blocks | bold italic backcolor | image media file | alignleft aligncenter alignright alignjustify | bullist numlist checklist outdent indent | removeformat | code table help"}})]})};export{Ee as default};
